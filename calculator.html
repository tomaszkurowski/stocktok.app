<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
        
            .form { display:flex; align-items:center; flex-wrap:wrap; }
            .form * { width:50%; margin-bottom:15px; }
            .form input { width:calc(50% - 10px); }
            
            .totals { display:flex; align-items:center; flex-wrap:wrap; }
            .totals * { width:50%; margin-bottom:15px; }
            
            
        </style>
        
        <script src="/media/js/external/jquery.min.js?version=3.5.1"></script>
        <script type="text/javascript">
        
            $(document).on('keyup','input',function(){
                
                let funds           = $('#funds').val();
                let price           = $('#price').val();
                let rate            = $('#rate').val();
                let precision_rate  = $('#precision-rate').val();
                let precision_total = $('#precision-total').val();
                
                let funds_pln = (funds * rate).toFixed(2);
                let rate_rounded = (1 / rate).toFixed(precision_rate); 
                                
                let purchased_total = (price * rate_rounded).toFixed(precision_total);
                let sold_total      = (price * rate_rounded).toFixed(precision_total); 
                let sold_total_pln  = (sold_total*rate).toFixed(2);
                
                let after_buy       = (funds - purchased_total).toFixed(precision_total);
                let after_buy_pln   = (after_buy*rate).toFixed(2);
                let after_sell      = (parseFloat(after_buy) + parseFloat(sold_total)).toFixed(precision_total);
                let after_sell_pln  = (after_sell * rate).toFixed(2);                
                
                $('#funds-total').html(funds+' $');
                $('#funds-pln').html(funds_pln+' pln');
                
                $('#rate-rounded').html(rate_rounded);
                $('#purchased-total').html(purchased_total+' $');
                $('#sold-total').html(sold_total+' $');
                $('#purchased-total-pln').html(price+' pln');
                $('#sold-total-pln').html(sold_total_pln+' pln');
                

                
                $('#after-buy').html(after_buy +' $');
                $('#after-buy-pln').html(after_buy_pln +' pln');
                $('#after-sell').html(after_sell+ ' $');
                $('#after-sell-pln').html(after_sell_pln+ ' pln');
                
                if (funds - after_sell === 0 && funds_pln - after_sell_pln === 0 && purchased_total === sold_total && parseFloat(price) === parseFloat(sold_total_pln)){
                    $('.tests').html('Success').addClass('success');
                }else{
                    $('.tests').html('Failed').removeClass('success');
                }
                
            });
            
        </script>
    </head>
    <body>
        <div class="form">
            
            <label>Funds</label>
            <input type="text" id="funds" />            
            
            <label>Price</label>
            <input type="text" id="price" />
            
            <label>Rate</label>
            <input type="text" id="rate" value="4.7" />            

            <label>Precision on Rate</label>
            <input type="text" id="precision-rate" />

            <label>Precision on Total</label>
            <input type="text" id="precision-total" />
        
        </div>
        <div class="tests"></div>
        
        <div class="totals">
            <h4>Rate</h4><div id="rate-rounded">0.00</div>
            <h4>Purchased Total</h4><div id="purchased-total">0.00</div>
            <h4>Sold Total</h4><div id="sold-total">0.00</div>
            <h4>Purchased Total (PLN)</h4><div id="purchased-total-pln">0.00</div>
            <h4>Sold Total (PLN)</h4><div id="sold-total-pln">0.00</div>
            
            <h4>Funds</h4><div id="funds-total">0.00</div>
            <h4>Funds after buy</h4><div id="after-buy">0.00</div>
            <h4>Funds (PLN)</h4><div id="funds-pln">0.00</div>            
            <h4>Funds after buy (PLN)</h4><div id="after-buy-pln">0.00</div>
            <h4>Funds after sell</h4><div id="after-sell">0.00</div>
            <h4>Funds after sell (PLN)</h4><div id="after-sell-pln">0.00</div>
        </div>
    </body>
</html>
